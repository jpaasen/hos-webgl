<html>
<header>
<title>Huygens' on Speed - WebGL/three.js</title>
<meta charset="utf-8">
<style>canvas {width: 100%; height: 100%}</style>
</header>

<body>
<script src="js/three.min.js"></script>
<script src="js/stats.min.js"></script>

<script type="x-shader/x-vertex" id='vertShader'>
	varying vec2 pixelPos;
	void main() {
		vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
		gl_Position = pos;
		pixelPos = vec2(pos.x, pos.y);
	}
</script>

<script type="x-shader/x-fragment" id='fragShader'>
	varying vec2 pixelPos;
	uniform float time;
	uniform float observationAreaSize;
	uniform float srcPosX;
	uniform float srcPosY;

	void main() {

		float c = 1540.0;
		float fs = 1e6;
		float pi = 3.14;

		vec3 obs = vec3(pixelPos.x*observationAreaSize, pixelPos.y*observationAreaSize, 0.0);
		vec3 src = vec3(srcPosX*observationAreaSize, srcPosY*observationAreaSize, 0.0);

		float dist = length(obs - src);
		float travelTime = dist / c;

		if (travelTime < time) {
			float sinValue = sin(2.0 * pi * fs * travelTime) / dist;
			sinValue = sinValue/2.0 + 0.5;
			gl_FragColor = vec4(sinValue, sinValue, sinValue, 1.0);
		} else {
			gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
		}

	}
</script>

<div id='mainFrame' onmousemove="update_coords(event)" onmousedown="mouse_down(event)" onmouseup="mouse_up(event)">
	
</div>

<script>

	var mouseDown = false;

	var observationAreaSize = 0.1;// meter 

	var uniforms = {
		time: { type: 'f', value: 0.0 }, 
		observationAreaSize: {type: 'f', value: observationAreaSize},
		srcPosX: { type: 'f', value: 0.0},
		srcPosY: { type: 'f', value: 0.0}
	};

	function reset(event) {
    	uniforms.time.value = 0.0;
	}

	function update_coords(event) {
		if (mouseDown) {
    		uniforms.srcPosX.value = (event.clientX / document.getElementById('mainFrame').offsetHeight - 0.5) *  2.0;
    		uniforms.srcPosY.value = (event.clientY / document.getElementById('mainFrame').offsetHeight - 0.5) * -2.0;
    	}
	}

	function mouse_down(event) {
		if (event.button == 0)
			mouseDown = true;
	}

	function mouse_up(event) {
		if (event.button == 0)
			mouseDown = false;
	}

	var container = document.getElementById('mainFrame');

	var width = window.innerHeight;
	var height = window.innerHeight;

	var scene = new THREE.Scene(); 
	var camera = new THREE.OrthographicCamera(-width/2, width/2, -height/2, height/2, 1, 1000);
	var renderer = new THREE.WebGLRenderer(); 
	renderer.setSize( width, height ); 
	container.appendChild( renderer.domElement );

	var stats = new Stats();
	stats.domElement.style.position = 'absolute';
	stats.domElement.style.top = '0px';
	container.appendChild( stats.domElement );

	var geometry = new THREE.BoxGeometry(width, height, 1);
	var vertShader = document.getElementById('vertShader').textContent;
	var fragShader = document.getElementById('fragShader').textContent;
	var material = new THREE.ShaderMaterial({uniforms: uniforms, vertexShader: vertShader, fragmentShader: fragShader});
	var cube = new THREE.Mesh( geometry, material );
	scene.add( cube );

	camera.position.z = 5;

	function render() {
		requestAnimationFrame(render);

		stats.update();

		uniforms.time.value += 1e-6;

		renderer.render(scene, camera);
	}
	render();
</script>

</body>

</html>
